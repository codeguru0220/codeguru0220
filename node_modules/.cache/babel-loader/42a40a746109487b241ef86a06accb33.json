{"ast":null,"code":"import { clear, drawParticle, drawParticlePlugin, drawPlugin, paintBase, paintImage } from \"../Utils/CanvasUtils\";\nimport { deepExtend, getLogger, safeMutationObserver } from \"../Utils/Utils\";\nimport { getStyleFromHsl, getStyleFromRgb, rangeColorToHsl, rangeColorToRgb } from \"../Utils/ColorUtils\";\nimport { generatedAttribute } from \"./Utils/Constants\";\n\nfunction setTransformValue(factor, newFactor, key) {\n  const newValue = newFactor[key];\n\n  if (newValue !== undefined) {\n    factor[key] = (factor[key] ?? 1) * newValue;\n  }\n}\n\nexport class Canvas {\n  constructor(container) {\n    this.container = container;\n\n    this._applyPostDrawUpdaters = particle => {\n      for (const updater of this._postDrawUpdaters) {\n        updater.afterDraw && updater.afterDraw(particle);\n      }\n    };\n\n    this._applyPreDrawUpdaters = (ctx, particle, radius, zOpacity, colorStyles, transform) => {\n      for (const updater of this._preDrawUpdaters) {\n        if (updater.getColorStyles) {\n          const {\n            fill,\n            stroke\n          } = updater.getColorStyles(particle, ctx, radius, zOpacity);\n\n          if (fill) {\n            colorStyles.fill = fill;\n          }\n\n          if (stroke) {\n            colorStyles.stroke = stroke;\n          }\n        }\n\n        if (updater.getTransformValues) {\n          const updaterTransform = updater.getTransformValues(particle);\n\n          for (const key in updaterTransform) {\n            setTransformValue(transform, updaterTransform, key);\n          }\n        }\n\n        updater.beforeDraw && updater.beforeDraw(particle);\n      }\n    };\n\n    this._applyResizePlugins = () => {\n      for (const plugin of this._resizePlugins) {\n        plugin.resize && plugin.resize();\n      }\n    };\n\n    this._getPluginParticleColors = particle => {\n      let fColor, sColor;\n\n      for (const plugin of this._colorPlugins) {\n        if (!fColor && plugin.particleFillColor) {\n          fColor = rangeColorToHsl(plugin.particleFillColor(particle));\n        }\n\n        if (!sColor && plugin.particleStrokeColor) {\n          sColor = rangeColorToHsl(plugin.particleStrokeColor(particle));\n        }\n\n        if (fColor && sColor) {\n          break;\n        }\n      }\n\n      return [fColor, sColor];\n    };\n\n    this._initCover = () => {\n      const options = this.container.actualOptions,\n            cover = options.backgroundMask.cover,\n            color = cover.color,\n            coverRgb = rangeColorToRgb(color);\n\n      if (coverRgb) {\n        const coverColor = { ...coverRgb,\n          a: cover.opacity\n        };\n        this._coverColorStyle = getStyleFromRgb(coverColor, coverColor.a);\n      }\n    };\n\n    this._initStyle = () => {\n      const element = this.element,\n            options = this.container.actualOptions;\n\n      if (!element) {\n        return;\n      }\n\n      if (this._fullScreen) {\n        this._originalStyle = deepExtend({}, element.style);\n\n        this._setFullScreenStyle();\n      } else {\n        this._resetOriginalStyle();\n      }\n\n      for (const key in options.style) {\n        if (!key || !options.style) {\n          continue;\n        }\n\n        const value = options.style[key];\n\n        if (!value) {\n          continue;\n        }\n\n        element.style.setProperty(key, value, \"important\");\n      }\n    };\n\n    this._initTrail = async () => {\n      const options = this.container.actualOptions,\n            trail = options.particles.move.trail,\n            trailFill = trail.fill;\n\n      if (!trail.enable) {\n        return;\n      }\n\n      if (trailFill.color) {\n        const fillColor = rangeColorToRgb(trailFill.color);\n\n        if (!fillColor) {\n          return;\n        }\n\n        const trail = options.particles.move.trail;\n        this._trailFill = {\n          color: { ...fillColor\n          },\n          opacity: 1 / trail.length\n        };\n      } else {\n        await new Promise((resolve, reject) => {\n          if (!trailFill.image) {\n            return;\n          }\n\n          const img = document.createElement(\"img\");\n          img.addEventListener(\"load\", () => {\n            this._trailFill = {\n              image: img,\n              opacity: 1 / trail.length\n            };\n            resolve();\n          });\n          img.addEventListener(\"error\", evt => {\n            reject(evt.error);\n          });\n          img.src = trailFill.image;\n        });\n      }\n    };\n\n    this._paintBase = baseColor => {\n      this.draw(ctx => paintBase(ctx, this.size, baseColor));\n    };\n\n    this._paintImage = (image, opacity) => {\n      this.draw(ctx => paintImage(ctx, this.size, image, opacity));\n    };\n\n    this._repairStyle = () => {\n      const element = this.element;\n\n      if (!element) {\n        return;\n      }\n\n      this._safeMutationObserver(observer => observer.disconnect());\n\n      this._initStyle();\n\n      this.initBackground();\n\n      this._safeMutationObserver(observer => observer.observe(element, {\n        attributes: true\n      }));\n    };\n\n    this._resetOriginalStyle = () => {\n      const element = this.element,\n            originalStyle = this._originalStyle;\n\n      if (!(element && originalStyle)) {\n        return;\n      }\n\n      const style = element.style;\n      style.position = originalStyle.position;\n      style.zIndex = originalStyle.zIndex;\n      style.top = originalStyle.top;\n      style.left = originalStyle.left;\n      style.width = originalStyle.width;\n      style.height = originalStyle.height;\n    };\n\n    this._safeMutationObserver = callback => {\n      if (!this._mutationObserver) {\n        return;\n      }\n\n      callback(this._mutationObserver);\n    };\n\n    this._setFullScreenStyle = () => {\n      const element = this.element;\n\n      if (!element) {\n        return;\n      }\n\n      const priority = \"important\",\n            style = element.style;\n      style.setProperty(\"position\", \"fixed\", priority);\n      style.setProperty(\"z-index\", this.container.actualOptions.fullScreen.zIndex.toString(10), priority);\n      style.setProperty(\"top\", \"0\", priority);\n      style.setProperty(\"left\", \"0\", priority);\n      style.setProperty(\"width\", \"100%\", priority);\n      style.setProperty(\"height\", \"100%\", priority);\n    };\n\n    this.size = {\n      height: 0,\n      width: 0\n    };\n    this._context = null;\n    this._generated = false;\n    this._preDrawUpdaters = [];\n    this._postDrawUpdaters = [];\n    this._resizePlugins = [];\n    this._colorPlugins = [];\n  }\n\n  get _fullScreen() {\n    return this.container.actualOptions.fullScreen.enable;\n  }\n\n  clear() {\n    const options = this.container.actualOptions,\n          trail = options.particles.move.trail,\n          trailFill = this._trailFill;\n\n    if (options.backgroundMask.enable) {\n      this.paint();\n    } else if (trail.enable && trail.length > 0 && trailFill) {\n      if (trailFill.color) {\n        this._paintBase(getStyleFromRgb(trailFill.color, trailFill.opacity));\n      } else if (trailFill.image) {\n        this._paintImage(trailFill.image, trailFill.opacity);\n      }\n    } else {\n      this.draw(ctx => {\n        clear(ctx, this.size);\n      });\n    }\n  }\n\n  destroy() {\n    this.stop();\n\n    if (this._generated) {\n      const element = this.element;\n      element && element.remove();\n    } else {\n      this._resetOriginalStyle();\n    }\n\n    this._preDrawUpdaters = [];\n    this._postDrawUpdaters = [];\n    this._resizePlugins = [];\n    this._colorPlugins = [];\n  }\n\n  draw(cb) {\n    const ctx = this._context;\n\n    if (!ctx) {\n      return;\n    }\n\n    return cb(ctx);\n  }\n\n  drawParticle(particle, delta) {\n    if (particle.spawning || particle.destroyed) {\n      return;\n    }\n\n    const radius = particle.getRadius();\n\n    if (radius <= 0) {\n      return;\n    }\n\n    const pfColor = particle.getFillColor(),\n          psColor = particle.getStrokeColor() ?? pfColor;\n\n    let [fColor, sColor] = this._getPluginParticleColors(particle);\n\n    if (!fColor) {\n      fColor = pfColor;\n    }\n\n    if (!sColor) {\n      sColor = psColor;\n    }\n\n    if (!fColor && !sColor) {\n      return;\n    }\n\n    this.draw(ctx => {\n      const container = this.container,\n            options = container.actualOptions,\n            zIndexOptions = particle.options.zIndex,\n            zOpacityFactor = (1 - particle.zIndexFactor) ** zIndexOptions.opacityRate,\n            opacity = particle.bubble.opacity ?? particle.opacity?.value ?? 1,\n            strokeOpacity = particle.strokeOpacity ?? opacity,\n            zOpacity = opacity * zOpacityFactor,\n            zStrokeOpacity = strokeOpacity * zOpacityFactor,\n            transform = {},\n            colorStyles = {\n        fill: fColor ? getStyleFromHsl(fColor, zOpacity) : undefined\n      };\n      colorStyles.stroke = sColor ? getStyleFromHsl(sColor, zStrokeOpacity) : colorStyles.fill;\n\n      this._applyPreDrawUpdaters(ctx, particle, radius, zOpacity, colorStyles, transform);\n\n      drawParticle({\n        container,\n        context: ctx,\n        particle,\n        delta,\n        colorStyles,\n        backgroundMask: options.backgroundMask.enable,\n        composite: options.backgroundMask.composite,\n        radius: radius * (1 - particle.zIndexFactor) ** zIndexOptions.sizeRate,\n        opacity: zOpacity,\n        shadow: particle.options.shadow,\n        transform\n      });\n\n      this._applyPostDrawUpdaters(particle);\n    });\n  }\n\n  drawParticlePlugin(plugin, particle, delta) {\n    this.draw(ctx => drawParticlePlugin(ctx, plugin, particle, delta));\n  }\n\n  drawPlugin(plugin, delta) {\n    this.draw(ctx => drawPlugin(ctx, plugin, delta));\n  }\n\n  async init() {\n    this._safeMutationObserver(obs => obs.disconnect());\n\n    this._mutationObserver = safeMutationObserver(records => {\n      for (const record of records) {\n        if (record.type === \"attributes\" && record.attributeName === \"style\") {\n          this._repairStyle();\n        }\n      }\n    });\n    this.resize();\n\n    this._initStyle();\n\n    this._initCover();\n\n    try {\n      await this._initTrail();\n    } catch (e) {\n      getLogger().error(e);\n    }\n\n    this.initBackground();\n\n    this._safeMutationObserver(obs => {\n      if (!this.element) {\n        return;\n      }\n\n      obs.observe(this.element, {\n        attributes: true\n      });\n    });\n\n    this.initUpdaters();\n    this.initPlugins();\n    this.paint();\n  }\n\n  initBackground() {\n    const options = this.container.actualOptions,\n          background = options.background,\n          element = this.element;\n\n    if (!element) {\n      return;\n    }\n\n    const elementStyle = element.style;\n\n    if (!elementStyle) {\n      return;\n    }\n\n    if (background.color) {\n      const color = rangeColorToRgb(background.color);\n      elementStyle.backgroundColor = color ? getStyleFromRgb(color, background.opacity) : \"\";\n    } else {\n      elementStyle.backgroundColor = \"\";\n    }\n\n    elementStyle.backgroundImage = background.image || \"\";\n    elementStyle.backgroundPosition = background.position || \"\";\n    elementStyle.backgroundRepeat = background.repeat || \"\";\n    elementStyle.backgroundSize = background.size || \"\";\n  }\n\n  initPlugins() {\n    this._resizePlugins = [];\n\n    for (const [, plugin] of this.container.plugins) {\n      if (plugin.resize) {\n        this._resizePlugins.push(plugin);\n      }\n\n      if (plugin.particleFillColor || plugin.particleStrokeColor) {\n        this._colorPlugins.push(plugin);\n      }\n    }\n  }\n\n  initUpdaters() {\n    this._preDrawUpdaters = [];\n    this._postDrawUpdaters = [];\n\n    for (const updater of this.container.particles.updaters) {\n      if (updater.afterDraw) {\n        this._postDrawUpdaters.push(updater);\n      }\n\n      if (updater.getColorStyles || updater.getTransformValues || updater.beforeDraw) {\n        this._preDrawUpdaters.push(updater);\n      }\n    }\n  }\n\n  loadCanvas(canvas) {\n    if (this._generated && this.element) {\n      this.element.remove();\n    }\n\n    this._generated = canvas.dataset && generatedAttribute in canvas.dataset ? canvas.dataset[generatedAttribute] === \"true\" : this._generated;\n    this.element = canvas;\n    this.element.ariaHidden = \"true\";\n    this._originalStyle = deepExtend({}, this.element.style);\n    this.size.height = canvas.offsetHeight;\n    this.size.width = canvas.offsetWidth;\n    this._context = this.element.getContext(\"2d\");\n\n    this._safeMutationObserver(obs => {\n      if (!this.element) {\n        return;\n      }\n\n      obs.observe(this.element, {\n        attributes: true\n      });\n    });\n\n    this.container.retina.init();\n    this.initBackground();\n  }\n\n  paint() {\n    const options = this.container.actualOptions;\n    this.draw(ctx => {\n      if (options.backgroundMask.enable && options.backgroundMask.cover) {\n        clear(ctx, this.size);\n\n        this._paintBase(this._coverColorStyle);\n      } else {\n        this._paintBase();\n      }\n    });\n  }\n\n  resize() {\n    if (!this.element) {\n      return false;\n    }\n\n    const container = this.container,\n          pxRatio = container.retina.pixelRatio,\n          size = container.canvas.size,\n          newSize = {\n      width: this.element.offsetWidth * pxRatio,\n      height: this.element.offsetHeight * pxRatio\n    };\n\n    if (newSize.height === size.height && newSize.width === size.width && newSize.height === this.element.height && newSize.width === this.element.width) {\n      return false;\n    }\n\n    const oldSize = { ...size\n    };\n    this.element.width = size.width = this.element.offsetWidth * pxRatio;\n    this.element.height = size.height = this.element.offsetHeight * pxRatio;\n\n    if (this.container.started) {\n      this.resizeFactor = {\n        width: size.width / oldSize.width,\n        height: size.height / oldSize.height\n      };\n    }\n\n    return true;\n  }\n\n  stop() {\n    this._safeMutationObserver(obs => obs.disconnect());\n\n    this._mutationObserver = undefined;\n    this.draw(ctx => clear(ctx, this.size));\n  }\n\n  async windowResize() {\n    if (!this.element || !this.resize()) {\n      return;\n    }\n\n    const container = this.container,\n          needsRefresh = container.updateActualOptions();\n    container.particles.setDensity();\n\n    this._applyResizePlugins();\n\n    if (needsRefresh) {\n      await container.refresh();\n    }\n  }\n\n}","map":{"version":3,"sources":["D:/mitsukimiyagi-portfolio/node_modules/tsparticles-engine/esm/Core/Canvas.js"],"names":["clear","drawParticle","drawParticlePlugin","drawPlugin","paintBase","paintImage","deepExtend","getLogger","safeMutationObserver","getStyleFromHsl","getStyleFromRgb","rangeColorToHsl","rangeColorToRgb","generatedAttribute","setTransformValue","factor","newFactor","key","newValue","undefined","Canvas","constructor","container","_applyPostDrawUpdaters","particle","updater","_postDrawUpdaters","afterDraw","_applyPreDrawUpdaters","ctx","radius","zOpacity","colorStyles","transform","_preDrawUpdaters","getColorStyles","fill","stroke","getTransformValues","updaterTransform","beforeDraw","_applyResizePlugins","plugin","_resizePlugins","resize","_getPluginParticleColors","fColor","sColor","_colorPlugins","particleFillColor","particleStrokeColor","_initCover","options","actualOptions","cover","backgroundMask","color","coverRgb","coverColor","a","opacity","_coverColorStyle","_initStyle","element","_fullScreen","_originalStyle","style","_setFullScreenStyle","_resetOriginalStyle","value","setProperty","_initTrail","trail","particles","move","trailFill","enable","fillColor","_trailFill","length","Promise","resolve","reject","image","img","document","createElement","addEventListener","evt","error","src","_paintBase","baseColor","draw","size","_paintImage","_repairStyle","_safeMutationObserver","observer","disconnect","initBackground","observe","attributes","originalStyle","position","zIndex","top","left","width","height","callback","_mutationObserver","priority","fullScreen","toString","_context","_generated","paint","destroy","stop","remove","cb","delta","spawning","destroyed","getRadius","pfColor","getFillColor","psColor","getStrokeColor","zIndexOptions","zOpacityFactor","zIndexFactor","opacityRate","bubble","strokeOpacity","zStrokeOpacity","context","composite","sizeRate","shadow","init","obs","records","record","type","attributeName","e","initUpdaters","initPlugins","background","elementStyle","backgroundColor","backgroundImage","backgroundPosition","backgroundRepeat","repeat","backgroundSize","plugins","push","updaters","loadCanvas","canvas","dataset","ariaHidden","offsetHeight","offsetWidth","getContext","retina","pxRatio","pixelRatio","newSize","oldSize","started","resizeFactor","windowResize","needsRefresh","updateActualOptions","setDensity","refresh"],"mappings":"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","sourcesContent":["import { clear, drawParticle, drawParticlePlugin, drawPlugin, paintBase, paintImage } from \"../Utils/CanvasUtils\";\nimport { deepExtend, getLogger, safeMutationObserver } from \"../Utils/Utils\";\nimport { getStyleFromHsl, getStyleFromRgb, rangeColorToHsl, rangeColorToRgb } from \"../Utils/ColorUtils\";\nimport { generatedAttribute } from \"./Utils/Constants\";\nfunction setTransformValue(factor, newFactor, key) {\n    const newValue = newFactor[key];\n    if (newValue !== undefined) {\n        factor[key] = (factor[key] ?? 1) * newValue;\n    }\n}\nexport class Canvas {\n    constructor(container) {\n        this.container = container;\n        this._applyPostDrawUpdaters = (particle) => {\n            for (const updater of this._postDrawUpdaters) {\n                updater.afterDraw && updater.afterDraw(particle);\n            }\n        };\n        this._applyPreDrawUpdaters = (ctx, particle, radius, zOpacity, colorStyles, transform) => {\n            for (const updater of this._preDrawUpdaters) {\n                if (updater.getColorStyles) {\n                    const { fill, stroke } = updater.getColorStyles(particle, ctx, radius, zOpacity);\n                    if (fill) {\n                        colorStyles.fill = fill;\n                    }\n                    if (stroke) {\n                        colorStyles.stroke = stroke;\n                    }\n                }\n                if (updater.getTransformValues) {\n                    const updaterTransform = updater.getTransformValues(particle);\n                    for (const key in updaterTransform) {\n                        setTransformValue(transform, updaterTransform, key);\n                    }\n                }\n                updater.beforeDraw && updater.beforeDraw(particle);\n            }\n        };\n        this._applyResizePlugins = () => {\n            for (const plugin of this._resizePlugins) {\n                plugin.resize && plugin.resize();\n            }\n        };\n        this._getPluginParticleColors = (particle) => {\n            let fColor, sColor;\n            for (const plugin of this._colorPlugins) {\n                if (!fColor && plugin.particleFillColor) {\n                    fColor = rangeColorToHsl(plugin.particleFillColor(particle));\n                }\n                if (!sColor && plugin.particleStrokeColor) {\n                    sColor = rangeColorToHsl(plugin.particleStrokeColor(particle));\n                }\n                if (fColor && sColor) {\n                    break;\n                }\n            }\n            return [fColor, sColor];\n        };\n        this._initCover = () => {\n            const options = this.container.actualOptions, cover = options.backgroundMask.cover, color = cover.color, coverRgb = rangeColorToRgb(color);\n            if (coverRgb) {\n                const coverColor = {\n                    ...coverRgb,\n                    a: cover.opacity,\n                };\n                this._coverColorStyle = getStyleFromRgb(coverColor, coverColor.a);\n            }\n        };\n        this._initStyle = () => {\n            const element = this.element, options = this.container.actualOptions;\n            if (!element) {\n                return;\n            }\n            if (this._fullScreen) {\n                this._originalStyle = deepExtend({}, element.style);\n                this._setFullScreenStyle();\n            }\n            else {\n                this._resetOriginalStyle();\n            }\n            for (const key in options.style) {\n                if (!key || !options.style) {\n                    continue;\n                }\n                const value = options.style[key];\n                if (!value) {\n                    continue;\n                }\n                element.style.setProperty(key, value, \"important\");\n            }\n        };\n        this._initTrail = async () => {\n            const options = this.container.actualOptions, trail = options.particles.move.trail, trailFill = trail.fill;\n            if (!trail.enable) {\n                return;\n            }\n            if (trailFill.color) {\n                const fillColor = rangeColorToRgb(trailFill.color);\n                if (!fillColor) {\n                    return;\n                }\n                const trail = options.particles.move.trail;\n                this._trailFill = {\n                    color: {\n                        ...fillColor,\n                    },\n                    opacity: 1 / trail.length,\n                };\n            }\n            else {\n                await new Promise((resolve, reject) => {\n                    if (!trailFill.image) {\n                        return;\n                    }\n                    const img = document.createElement(\"img\");\n                    img.addEventListener(\"load\", () => {\n                        this._trailFill = {\n                            image: img,\n                            opacity: 1 / trail.length,\n                        };\n                        resolve();\n                    });\n                    img.addEventListener(\"error\", (evt) => {\n                        reject(evt.error);\n                    });\n                    img.src = trailFill.image;\n                });\n            }\n        };\n        this._paintBase = (baseColor) => {\n            this.draw((ctx) => paintBase(ctx, this.size, baseColor));\n        };\n        this._paintImage = (image, opacity) => {\n            this.draw((ctx) => paintImage(ctx, this.size, image, opacity));\n        };\n        this._repairStyle = () => {\n            const element = this.element;\n            if (!element) {\n                return;\n            }\n            this._safeMutationObserver((observer) => observer.disconnect());\n            this._initStyle();\n            this.initBackground();\n            this._safeMutationObserver((observer) => observer.observe(element, { attributes: true }));\n        };\n        this._resetOriginalStyle = () => {\n            const element = this.element, originalStyle = this._originalStyle;\n            if (!(element && originalStyle)) {\n                return;\n            }\n            const style = element.style;\n            style.position = originalStyle.position;\n            style.zIndex = originalStyle.zIndex;\n            style.top = originalStyle.top;\n            style.left = originalStyle.left;\n            style.width = originalStyle.width;\n            style.height = originalStyle.height;\n        };\n        this._safeMutationObserver = (callback) => {\n            if (!this._mutationObserver) {\n                return;\n            }\n            callback(this._mutationObserver);\n        };\n        this._setFullScreenStyle = () => {\n            const element = this.element;\n            if (!element) {\n                return;\n            }\n            const priority = \"important\", style = element.style;\n            style.setProperty(\"position\", \"fixed\", priority);\n            style.setProperty(\"z-index\", this.container.actualOptions.fullScreen.zIndex.toString(10), priority);\n            style.setProperty(\"top\", \"0\", priority);\n            style.setProperty(\"left\", \"0\", priority);\n            style.setProperty(\"width\", \"100%\", priority);\n            style.setProperty(\"height\", \"100%\", priority);\n        };\n        this.size = {\n            height: 0,\n            width: 0,\n        };\n        this._context = null;\n        this._generated = false;\n        this._preDrawUpdaters = [];\n        this._postDrawUpdaters = [];\n        this._resizePlugins = [];\n        this._colorPlugins = [];\n    }\n    get _fullScreen() {\n        return this.container.actualOptions.fullScreen.enable;\n    }\n    clear() {\n        const options = this.container.actualOptions, trail = options.particles.move.trail, trailFill = this._trailFill;\n        if (options.backgroundMask.enable) {\n            this.paint();\n        }\n        else if (trail.enable && trail.length > 0 && trailFill) {\n            if (trailFill.color) {\n                this._paintBase(getStyleFromRgb(trailFill.color, trailFill.opacity));\n            }\n            else if (trailFill.image) {\n                this._paintImage(trailFill.image, trailFill.opacity);\n            }\n        }\n        else {\n            this.draw((ctx) => {\n                clear(ctx, this.size);\n            });\n        }\n    }\n    destroy() {\n        this.stop();\n        if (this._generated) {\n            const element = this.element;\n            element && element.remove();\n        }\n        else {\n            this._resetOriginalStyle();\n        }\n        this._preDrawUpdaters = [];\n        this._postDrawUpdaters = [];\n        this._resizePlugins = [];\n        this._colorPlugins = [];\n    }\n    draw(cb) {\n        const ctx = this._context;\n        if (!ctx) {\n            return;\n        }\n        return cb(ctx);\n    }\n    drawParticle(particle, delta) {\n        if (particle.spawning || particle.destroyed) {\n            return;\n        }\n        const radius = particle.getRadius();\n        if (radius <= 0) {\n            return;\n        }\n        const pfColor = particle.getFillColor(), psColor = particle.getStrokeColor() ?? pfColor;\n        let [fColor, sColor] = this._getPluginParticleColors(particle);\n        if (!fColor) {\n            fColor = pfColor;\n        }\n        if (!sColor) {\n            sColor = psColor;\n        }\n        if (!fColor && !sColor) {\n            return;\n        }\n        this.draw((ctx) => {\n            const container = this.container, options = container.actualOptions, zIndexOptions = particle.options.zIndex, zOpacityFactor = (1 - particle.zIndexFactor) ** zIndexOptions.opacityRate, opacity = particle.bubble.opacity ?? particle.opacity?.value ?? 1, strokeOpacity = particle.strokeOpacity ?? opacity, zOpacity = opacity * zOpacityFactor, zStrokeOpacity = strokeOpacity * zOpacityFactor, transform = {}, colorStyles = {\n                fill: fColor ? getStyleFromHsl(fColor, zOpacity) : undefined,\n            };\n            colorStyles.stroke = sColor ? getStyleFromHsl(sColor, zStrokeOpacity) : colorStyles.fill;\n            this._applyPreDrawUpdaters(ctx, particle, radius, zOpacity, colorStyles, transform);\n            drawParticle({\n                container,\n                context: ctx,\n                particle,\n                delta,\n                colorStyles,\n                backgroundMask: options.backgroundMask.enable,\n                composite: options.backgroundMask.composite,\n                radius: radius * (1 - particle.zIndexFactor) ** zIndexOptions.sizeRate,\n                opacity: zOpacity,\n                shadow: particle.options.shadow,\n                transform,\n            });\n            this._applyPostDrawUpdaters(particle);\n        });\n    }\n    drawParticlePlugin(plugin, particle, delta) {\n        this.draw((ctx) => drawParticlePlugin(ctx, plugin, particle, delta));\n    }\n    drawPlugin(plugin, delta) {\n        this.draw((ctx) => drawPlugin(ctx, plugin, delta));\n    }\n    async init() {\n        this._safeMutationObserver((obs) => obs.disconnect());\n        this._mutationObserver = safeMutationObserver((records) => {\n            for (const record of records) {\n                if (record.type === \"attributes\" && record.attributeName === \"style\") {\n                    this._repairStyle();\n                }\n            }\n        });\n        this.resize();\n        this._initStyle();\n        this._initCover();\n        try {\n            await this._initTrail();\n        }\n        catch (e) {\n            getLogger().error(e);\n        }\n        this.initBackground();\n        this._safeMutationObserver((obs) => {\n            if (!this.element) {\n                return;\n            }\n            obs.observe(this.element, { attributes: true });\n        });\n        this.initUpdaters();\n        this.initPlugins();\n        this.paint();\n    }\n    initBackground() {\n        const options = this.container.actualOptions, background = options.background, element = this.element;\n        if (!element) {\n            return;\n        }\n        const elementStyle = element.style;\n        if (!elementStyle) {\n            return;\n        }\n        if (background.color) {\n            const color = rangeColorToRgb(background.color);\n            elementStyle.backgroundColor = color ? getStyleFromRgb(color, background.opacity) : \"\";\n        }\n        else {\n            elementStyle.backgroundColor = \"\";\n        }\n        elementStyle.backgroundImage = background.image || \"\";\n        elementStyle.backgroundPosition = background.position || \"\";\n        elementStyle.backgroundRepeat = background.repeat || \"\";\n        elementStyle.backgroundSize = background.size || \"\";\n    }\n    initPlugins() {\n        this._resizePlugins = [];\n        for (const [, plugin] of this.container.plugins) {\n            if (plugin.resize) {\n                this._resizePlugins.push(plugin);\n            }\n            if (plugin.particleFillColor || plugin.particleStrokeColor) {\n                this._colorPlugins.push(plugin);\n            }\n        }\n    }\n    initUpdaters() {\n        this._preDrawUpdaters = [];\n        this._postDrawUpdaters = [];\n        for (const updater of this.container.particles.updaters) {\n            if (updater.afterDraw) {\n                this._postDrawUpdaters.push(updater);\n            }\n            if (updater.getColorStyles || updater.getTransformValues || updater.beforeDraw) {\n                this._preDrawUpdaters.push(updater);\n            }\n        }\n    }\n    loadCanvas(canvas) {\n        if (this._generated && this.element) {\n            this.element.remove();\n        }\n        this._generated =\n            canvas.dataset && generatedAttribute in canvas.dataset\n                ? canvas.dataset[generatedAttribute] === \"true\"\n                : this._generated;\n        this.element = canvas;\n        this.element.ariaHidden = \"true\";\n        this._originalStyle = deepExtend({}, this.element.style);\n        this.size.height = canvas.offsetHeight;\n        this.size.width = canvas.offsetWidth;\n        this._context = this.element.getContext(\"2d\");\n        this._safeMutationObserver((obs) => {\n            if (!this.element) {\n                return;\n            }\n            obs.observe(this.element, { attributes: true });\n        });\n        this.container.retina.init();\n        this.initBackground();\n    }\n    paint() {\n        const options = this.container.actualOptions;\n        this.draw((ctx) => {\n            if (options.backgroundMask.enable && options.backgroundMask.cover) {\n                clear(ctx, this.size);\n                this._paintBase(this._coverColorStyle);\n            }\n            else {\n                this._paintBase();\n            }\n        });\n    }\n    resize() {\n        if (!this.element) {\n            return false;\n        }\n        const container = this.container, pxRatio = container.retina.pixelRatio, size = container.canvas.size, newSize = {\n            width: this.element.offsetWidth * pxRatio,\n            height: this.element.offsetHeight * pxRatio,\n        };\n        if (newSize.height === size.height &&\n            newSize.width === size.width &&\n            newSize.height === this.element.height &&\n            newSize.width === this.element.width) {\n            return false;\n        }\n        const oldSize = { ...size };\n        this.element.width = size.width = this.element.offsetWidth * pxRatio;\n        this.element.height = size.height = this.element.offsetHeight * pxRatio;\n        if (this.container.started) {\n            this.resizeFactor = {\n                width: size.width / oldSize.width,\n                height: size.height / oldSize.height,\n            };\n        }\n        return true;\n    }\n    stop() {\n        this._safeMutationObserver((obs) => obs.disconnect());\n        this._mutationObserver = undefined;\n        this.draw((ctx) => clear(ctx, this.size));\n    }\n    async windowResize() {\n        if (!this.element || !this.resize()) {\n            return;\n        }\n        const container = this.container, needsRefresh = container.updateActualOptions();\n        container.particles.setDensity();\n        this._applyResizePlugins();\n        if (needsRefresh) {\n            await container.refresh();\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}